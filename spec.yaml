extends: spectral:oas

rules:
  api-root:
    description: API MUST have a root path defined (`/`)
    severity: error
    given: $.paths
    then:
      field: /
      function: truthy
 
  api-root-get:
    description: Root path MUST have a GET defined, otherwise people won't know how to get it
    severity: error
    given: $.paths[/]
    then:
      field: get
      function: truthy

  paths-kebab-case:
    description: Paths MUST be kebab-case.
    message: '{{property}} should be kebab-case'
    severity: warn
    given: $.paths[*]~
    then:
      function: pattern
      functionOptions:
        match: '^(\/|[a-z0-9-.]+|{[a-zA-Z0-9_]+})+$'

  operation-short-summary: 
    description: Operation summary should be short and sweet, no full stops, and less than 20 characters
    recommended: true
    type: style
    given: $.paths.*[?( @property === 'get' || @property === 'put' || @property === 'post' || @property === 'delete' || @property === 'options' || @property === 'head' || @property === 'patch' || @property === 'trace' )]
    then:
      - field: summary
        function: pattern
        functionOptions:
          notMatch: '\\.'
      - field: summary
        function: length
        functionOptions:
          max: 20

  schema-names-pascal-case:
    description: Schema names MUST be written in PascalCase
    message: '{{property}} is not PascalCase: {{error}}'
    recommended: true
    type: style
    given: '$.components.schemas.*~'
    then:
      function: pattern
      functionOptions:
        match: '^[A-Z][a-zA-Z0-9]*$'

  semver:
    description: Schema names MUST be written in PascalCase
    severity: error
    recommended: true
    message: 'Please follow semantic versioning. {{value}} is not a valid version.'
    given: $.info.version
    then:
      function: pattern
      functionOptions:
        match: '^([0-9]+.[0-9]+.[0-9]+)$'

  no-x-headers:
    description: Header MUST not be prefixed wit X- (https://tools.ietf.org/html/rfc6648)
    message: "Headers MUST not be prefixed with X-. Please find a new name for {{property}}"
    given: $..parameters.[?(@.in === 'header')].name
    then:
      function: pattern
      functionOptions:
        notMatch: '^(x|X)-'

  headers-hyphenated-pascal-case:
    description: All HTTP headers MUST use Hyphenated-Pascal-Case notation
    message: "'HTTP' headers MUST follow 'Hyphenated-Pascal-Case' notation"
    severity: error
    given: $..parameters[?(@.in == 'header')].name
    type: style
    then: 
      function: pattern
      functionOptions:
        match: '/^([A-Z][a-z0-9]-)*([A-Z][a-z0-9])+/'

  request-get-no-body:
    description: A GET request MUST NOT accept a body parameter
    severity: error
    given: $.paths..get.parameters..in
    then:
      function: pattern
      functionOptions:
        notMatch: '/^body$/'
